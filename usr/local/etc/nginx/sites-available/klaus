upstream klaus {
  server 127.0.0.1:8080;
}
## Redirects all HTTP traffic to the HTTPS host
server {
    listen   127.0.0.1:80 default_server;
    server_name localhost.localdomain;
    return 302 https://$host$request_uri;
    access_log  /var/log/nginx_klaus_access.log;
    error_log   /var/log/nginx_klaus_error.log;
}
## HTTPS host
server {
    listen 443 ssl;
    server_name localhost.localdomain;
    ssl_certificate ssl/ssl.crt;
    ssl_certificate_key ssl/ssl.key;
    include /usr/local/etc/nginx/tls.conf;
    access_log  /var/log/nginx_klaus_access_ssl.log;
    error_log   /var/log/nginx_klaus_error_ssl.log;
    location / {
        try_files $uri $uri/ @klaus;
    }
    location @klaus {
        include /usr/local/etc/nginx/proxypass.conf;
        # https://github.com/jonashaag/klaus/blob/master/klaus/utils.py#L25
        proxy_set_header X-Scheme $scheme;
        proxy_pass http://klaus;
    }
}
