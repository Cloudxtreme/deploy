#!/bin/sh

# TODO: THIS IS A WORK IN PROGRESS

######################################################################
# Script version is yymmdd-HHMMSS in UTC, date -u +%y%m%d-%H%M%S
######################################################################
SCRIPTVERSION=150621-235310

if [ "x" == "x${REPOSRC}" ]; then
    REPOSRC=https://github.com/
fi

# Based on https://github.com/qq99/echoplexus/blob/master/INSTALL.md

echo "git:1006:::::echoplexus:/usr/home/echoplexus:/usr/sbin/nologin:" | adduser -w no -f -
pw user mod echoplexus -G redis

pkg install -y www/node www/npm sudo git nginx ruby ruby21-gems redis

cd /home/echoplexus
sudo -u echoplexus -H git clone ${REPOSRC}qq99/echoplexus.git

sudo -u echoplexus -H npm install
npm install -g coffee-script grunt grunt-cli supervisor bower browserify testem

sudo -u echoplexus -H bower install

sudo -u echoplexus -H gem install sass

sysrc redis_enable="YES"

echo
JAILIP=`ifconfig | grep inet | awk '{print $2}'`
echo "Visit http://${JAILIP}/"
