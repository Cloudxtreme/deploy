#!/bin/sh

# TODO

######################################################################
# Script version is yymmdd-HHMMSS in UTC, date -u +%y%m%d-%H%M%S
######################################################################
SCRIPTVERSION=150706-002109

cd ~/git/vmrc
sh install-vmrc.sh
if ! ls /usr/local/vmrc/vm/ | grep pfsense ; then
    sh mkvm.sh pfsense223amd64raw pfsense
fi
if ! ls /dev/vmm/ | grep pfsense ; then
    service vm oneload pfsense0
fi

cat <<EOF

The default user and password is: admin and pfsense

EOF

checkmytap() {
    while [ 1 -eq 1 ] ; do
        tapcount=`ifconfig -l | grep -o tap | wc -l`
        if [ ${tapcount} -gt 1 ]; then
            gdf
            exit
        fi
        sleep 1
    done
}

if ls /dev/vmm/ | grep pfsense ; then
    checkmytap &
    service vm oneboot pfsense0
fi
