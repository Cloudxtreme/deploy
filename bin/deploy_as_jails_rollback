#!/bin/sh

# READY

if sysctl security.jail.jailed | grep 1 >/dev/null 2>&1; then
    echo "ERROR: Cannot run in a jail"
    exit 1
fi

. ~/bin/deploy_as_conf

JAILNAMES="${GOOD} ${BAD} ${DEV}"

eza stop

echo "$JAILNAMES" \
| while read num name ; do
    if [ "x" != "x${num}" ] && [ "x" != "x${name}" ]; then
        if [ "xsquid" != "x${name}" ]; then
            if zfs list -H tank/ezjail/${name}@created 2>/dev/null ; then
                zfs rollback tank/ezjail/${name}@created
            fi
        fi
    fi
done
